{
  "hash": "9b28e4f5c03c6f7946c9b20388377bc4",
  "result": {
    "markdown": "---\ntitle: \"Algal Blooms in Santa Barbara\"\ndescription: \"Analyzing the Affects of Sea Surface Temperature on Toxic Algal Blooms\"\nauthor:\n  - name: Kate Becker\ndate: 12-15-2023\ncategories: [Quarto, R, MEDS, Stastics, Sea Surface Temperature, Marine, Climate Change] \nimage: 1800.jpg.webp\ndraft: true \n---\n\n\n# Does Seasonality Have an Effect on Pseudo-nitzschia Algal Abundance and Distribution?\n\nIn the last few weeks, Santa Barbara has seen an unprecedented number of marine mammals washing up on their shores. Previous research has suggested that a particular algal species is responsible, Pseudo-nitzschia. This particular species produces domoic acid, a neurotoxin that causes seizures, brain damage and death in marine mammal. These blooms can be greatly enhanced by run off, eutrophication, and El Nino cycling where strong upwelling years foster bloom all of which are occurring right now in Santa Barbara. These reports have also been documented in coastal waters along the West Coast, Gulf of Mexico, and in the Gulf of Maine affecting all animals of the food web.\n\nThe motivation for this study was formed from the questions surrounding these blooms. What is causing them? Can we predict when they will occur next? Can we prevent them? What conditions allow this species to thrive?\n\nFor more information regarding the data, workflow, and reproducibility of this project please see the attached Git hub link: <https://github.com/kateebeckerr/algalblooms_sb>\n\n## Data Descriptors: \n\n1.  **Algal Events, Occurrences, and Measure**\n\n(2022). California Harmful Algal Bloom Monitoring and Alert Program Data. EDI Repository.[ https://portal.edirepository.org/nis/metadataviewer?packageid=edi.988.8](https://portal.edirepository.org/nis/metadataviewer?packageid=edi.988.8))\n\nRelevant Variables:\n-   Location id (Selected for Stearns Wharf)\n-   Organism scientific name\n-   Organism Quantity (cells/L)\n\n2.   **Sea Surface Temperature in Santa Barbara**\n\nSanta Barbara Coastal LTER, Kui, Li. (2023). Daily sea surface temperature in Santa Barbara channel between 1982 and 2021. EDI Repository. URL[ https://portal.edirepository.org/nis/mapbrowse?scope=knb-lter-sbc&identifier=161](https://portal.edirepository.org/nis/mapbrowse?scope=knb-lter-sbc&identifier=161))\n\nRelevant Variables:\n-   Date (2007 -\\> 2020)\n-   Site (SITE 1 Santa Barbara)\n-   Temperature ([°](https://www.degreesymbol.net/)C)\n-   Latitude\n-   Longitude\n\n## Relvant Libraries and Functions\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.3     ✔ readr     2.1.4\n✔ forcats   1.0.0     ✔ stringr   1.5.0\n✔ lubridate 1.9.2     ✔ tibble    3.2.1\n✔ purrr     1.0.2     ✔ tidyr     1.3.0\n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n:::\n\n```{.r .cell-code}\nlibrary(here)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nhere() starts at /Users/katebecker/Documents/Bren/kateebeckerr.github.io\n```\n:::\n\n```{.r .cell-code}\nlibrary(janitor)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'janitor'\n\nThe following objects are masked from 'package:stats':\n\n    chisq.test, fisher.test\n```\n:::\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(lubridate)\nlibrary(sf)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nLinking to GEOS 3.11.0, GDAL 3.5.3, PROJ 9.1.0; sf_use_s2() is TRUE\n```\n:::\n\n```{.r .cell-code}\nlibrary(terra)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nterra 1.7.46\n\nAttaching package: 'terra'\n\nThe following object is masked from 'package:janitor':\n\n    crosstab\n\nThe following object is masked from 'package:tidyr':\n\n    extract\n```\n:::\n\n```{.r .cell-code}\nlibrary(spData)\nlibrary(spDataLarge)\nlibrary(maps)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'maps'\n\nThe following object is masked from 'package:purrr':\n\n    map\n```\n:::\n\n```{.r .cell-code}\nlibrary(stringr)\nlibrary(viridis)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: viridisLite\n\nAttaching package: 'viridis'\n\nThe following object is masked from 'package:maps':\n\n    unemp\n```\n:::\n\n```{.r .cell-code}\nlibrary(gstat)\nlibrary(sp)\nlibrary(automap)\nlibrary(tufte)\nlibrary(feasts)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: fabletools\n\nAttaching package: 'fabletools'\n\nThe following object is masked from 'package:terra':\n\n    interpolate\n```\n:::\n\n```{.r .cell-code}\nlibrary(forecast)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nRegistered S3 method overwritten by 'quantmod':\n  method            from\n  as.zoo.data.frame zoo \n```\n:::\n\n```{.r .cell-code}\nlibrary(tsibble)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'tsibble'\n\nThe following objects are masked from 'package:terra':\n\n    intersect, union\n\nThe following object is masked from 'package:lubridate':\n\n    interval\n\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, union\n```\n:::\n\n```{.r .cell-code}\nlibrary(tsibble)\nlibrary(feasts)\nlibrary(tmap)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nBreaking News: tmap 3.x is retiring. Please test v4, e.g. with\nremotes::install_github('r-tmap/tmap')\n```\n:::\n\n```{.r .cell-code}\nlibrary(zoo)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'zoo'\n\nThe following object is masked from 'package:tsibble':\n\n    index\n\nThe following object is masked from 'package:terra':\n\n    time<-\n\nThe following objects are masked from 'package:base':\n\n    as.Date, as.Date.numeric\n```\n:::\n\n```{.r .cell-code}\nlibrary(spData)\nlibrary(purrr)\nlibrary(forcats)\nlibrary(readr)\nlibrary(gt)\n```\n:::\n\n\n## Setting The Working Directory\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrm(list = ls())\nhere::i_am(\"algae_temp_analysis.qmd\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nhere() starts at /Users/katebecker/Documents/Bren/kateebeckerr.github.io/posts/Algae_Stats\n```\n:::\n\n```{.r .cell-code}\nsetwd(here())\n```\n:::\n\n\n## Data Read In\n\n\n::: {.cell}\n\n```{.r .cell-code}\nalgal_events <- read_csv(\"/Users/katebecker/Documents/Bren/Fall_Q/EDS_222/ final_proj/algalblooms_sb/data/edi/event.csv\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nRows: 4448 Columns: 12\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr  (6): id, eventID, geodeticDatum, countryCode, locationID, eventRemarks\ndbl  (5): decimalLatitude, decimalLongitude, minimumDepthInMeters, maximumDe...\ndttm (1): eventDate\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n:::\n\n```{.r .cell-code}\nalgal_measure <- read_csv(\"/Users/katebecker/Documents/Bren/Fall_Q/EDS_222/ final_proj/algalblooms_sb/data/edi/extendedmeasurementorfact.csv\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nRows: 44955 Columns: 7\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (6): id, measurementType, measurementID, measurementTypeID, measurementU...\ndbl (1): measurementValue\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n:::\n\n```{.r .cell-code}\nalgal_occurence <- read_csv(\"/Users/katebecker/Documents/Bren/Fall_Q/EDS_222/ final_proj/algalblooms_sb/data/edi/occurrence.csv\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nRows: 28892 Columns: 11\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (10): id, basisOfRecord, organismName, organismQuantityType, occurrenceI...\ndbl  (1): organismQuantity\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n:::\n\n```{.r .cell-code}\nsst <- read_csv(\"/Users/katebecker/Documents/Bren/Fall_Q/EDS_222/ final_proj/algalblooms_sb/data/sst/sst_original_data.csv\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nRows: 262944 Columns: 5\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr  (1): site\ndbl  (3): latitude, longitude, temp\ndate (1): date\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n:::\n:::\n\n\n# Analysis \n\n## Data Exploration \n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Algal Events \n#head(algal_events)\n#shape(algal_events)\n#class(algal_events)\n\n#Algal Meausre\n#head(algal_measure)\n#shape(algal_measure)\n#class(algal_measure)\n\n\n# Algal Occurence\n#shape(algal_occurence)\n#head(algal_occurence)\n#class(algal_measure)\n#shape(algal_occurence)\n\n#SST\n#head(sst)\n#class(sst)\n#shape(sst)\n#class(sst)\n```\n:::\n\n\n## Data Wrangling \n\n### Algae Data\n\nGrouping by organism and filtering for the toxic algae Pseudo nitzschia and specific location will also be filtered for \"Stearns Wharf\".\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnames_algae <- algal_occurence %>%\n  group_by(organismName) %>% #grouping by organism name\n  na.omit() #omitting na\n\npseudo_algae <- algal_occurence %>%\n  filter(organismName == \"Pseudo_nitzschia_seriata_group\") #filter for toxic algal species\n\njoin <- left_join(pseudo_algae, algal_events, by = \"id\") #left join algal_events into pseuo_algae by ID\n\njoin_stearns <- join %>%\n  filter(locationID == \"HABs-StearnsWharf\") %>% #filter for location ID of Stearns Wharf in SB\n  mutate(year = format(eventDate, \"%Y\")) #Create a year column by extracting it from eventDate variable\n```\n:::\n\n\n\n\n### SST Data\n\nFiltering for data between the years 2007 and 2022 as well as for \"SITE1\" Stearns Wharf\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsst_filter <- sst %>%\n  mutate(year = format(date, \"%Y\")) #adds a new column named year to the sst dataframe by extracting the year value from date \n\nupdated_sst <- sst_filter %>% #creates a new df filtering only rows where year column is greater than or equal to 2007 and less than or equal to 2022\n  filter(year >= 2007 & year <= 2022)\n\nsst_filter <- sst_filter %>%\n  mutate(index = as.Date(date)) #adds a new column, index, which is created by converting the date column to a date object\n\nsst_filter <- na.omit(sst_filter) #omits na\n\nsst_filter <- sst_filter %>%\n  arrange(index) #sorts dataframe by index column\n\nsst_filter <- sst_filter %>%\n  mutate(index = as.Date(date),\n         temp = as.numeric(temp)) #converting temp column to numeric\n\n#Repeats steps but for SITE1 exlusively \nsst_site1 <- sst_filter %>%\n  filter(site == \"SITE1\") #filtering for SITE1 (Stearns Warf)\n\nsst_filter1 <- sst_site1 %>%\n  mutate(index = as.Date(date))  #adds a new column, index, which is creaed by converting date column to a date object\n\nsst_filter1 <- na.omit(sst_filter1) #omits na\n\nsst_filter <- sst_filter1 %>%\n  arrange(index) #sorts df by index column\n\nsst_filter1 <- sst_filter1 %>%\n  mutate(index = as.Date(date),\n         temp = as.numeric(temp)) #converting temp into a numeric\n```\n:::\n\n\n## Joining Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndate_join_stearns <- left_join(join_stearns, updated_sst, by =\"year\") #join into join_stearns by id\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning in left_join(join_stearns, updated_sst, by = \"year\"): Detected an unexpected many-to-many relationship between `x` and `y`.\nℹ Row 1 of `x` matches multiple rows in `y`.\nℹ Row 6571 of `y` matches multiple rows in `x`.\nℹ If a many-to-many relationship is expected, set `relationship =\n  \"many-to-many\"` to silence this warning.\n```\n:::\n\n```{.r .cell-code}\njoin <- join[complete.cases(join$decimalLatitude, join$decimalLongitude), ] #filters rows in join dataframe whre both lat and long are not missing\njoin_sf <- st_as_sf(join, coords = c(\"decimalLatitude\", \"decimalLongitude\"), crs = 4326) #converts join df into a spatial feature and uses crs 4326\n\ndate_join_stearns <- date_join_stearns %>%\n  mutate(y_m = yearmonth(date)) %>% #adds a y_m columm representing year and month of the date column \n  filter(!is.na(date)) #filters out rows where date is not missing \n```\n:::\n\n\n## Data Exploration\n\n### Plotting Temp and Date Relationship\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlinear_model <- lm(temp ~ date, data = updated_sst) #fits a linear model\nslope <- coef(linear_model)[2] #extracts slope coefficient for data variable from linear model \n\n#we've all see this general trend, showing seasonal oscillations\nggplot(data = updated_sst, aes(x = date, y = temp)) +\n  geom_point(color = \"#726161\", size = 0.25) +\n  geom_smooth(method = \"lm\", se = FALSE, color = \"red\") + #adds a treadline to plot using linear model \n  labs(x = \"Time\", \n       y = \"Sea Surface Temperature (°C)\") + \n  ggtitle(\"Sea Surface Temperature Trend Over the Last 15 Years\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n:::\n\n::: {.cell-output-display}\n![](algae_temp_analysis_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\nSea surface temperature over the last 15 years shows a prominent trend. There's clear seasonality and a steady upward trend likely to continue in the following years.\n\n## Statistical Analysis \n\nH0: Seasonality does affect algal bloom abundance and distribution\n\nHA: Seasonality does not affect algal bloom abundance and Distribution\n\n### Linear Regression\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(lm(temp ~ date, data = sst_filter))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = temp ~ date, data = sst_filter)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-4.3314 -1.2862 -0.2467  1.1287  6.9665 \n\nCoefficients:\n             Estimate Std. Error t value Pr(>|t|)    \n(Intercept) 1.471e+01  4.239e-02 347.041   <2e-16 ***\ndate        2.176e-06  3.412e-06   0.638    0.524    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 1.739 on 14606 degrees of freedom\nMultiple R-squared:  2.784e-05,\tAdjusted R-squared:  -4.063e-05 \nF-statistic: 0.4066 on 1 and 14606 DF,  p-value: 0.5237\n```\n:::\n:::\n\n\nA p-value of 2.2×10−162.2×10−16 is extremely small and essentially zero. In statistical hypothesis testing, a common significance level (alpha) is 0.05. If the p-value is less than 0.05, the null hypothesis is typically rejected, suggesting that there is evidence to support the alternative hypothesis. In this case, with a p-value much smaller than 0.05 (specifically, 2.2×10−162.2×10−16), it indicates strong evidence against the null hypothesis. You would generally conclude that there is a statistically significant relationship between the independent variable(s) in your linear regression model and the dependent variable but this value and the coefficients don't correlate to the rrange of this data.\n\nIn summary, based on the p-value provided we can reject null hypothesis, supporting the idea that there is a statistically significant relationship in the linear regression model. Unfortunately, due to how small the p-value is it should cause pause.\n\n### Decomposition\n\nIsolating each component of the time series visually and quantitatively\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndecomp_stearn <- date_join_stearns %>%\n  filter(!is.na(date)) %>%  #filters out where date is not missing\n  mutate(y_m = yearmonth(date)) %>% #add a new column y_m representing year and month from date column\n  group_by(y_m) %>% #groups data by year and month\n  summarise(total_quant = sum(organismQuantity, na.rm = TRUE)) %>% #calculates total quantity of organism for each group ignoring missing values\n  mutate(total_quant = na.approx(total_quant)) %>% #interpolates missing values in total_quant column\n  as_tsibble(index = y_m) #converts data to a tsibble\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndecomp_stearn %>% model( #specifies the STL decomposition time series model \n    STL(total_quant)\n  ) %>%\n  components() %>% #extracts components (trend, seasonality, and remainder) from decomposition\n  autoplot() + #creates a visualization\n  labs(title = \"Stearns Warf, Santa Barbara\")\n```\n\n::: {.cell-output-display}\n![](algae_temp_analysis_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n\\*Data ends in 2022 so we can only infer what the trend looks like as it approaches 2024\n\nIn 2015, the US west coast suffered the worst, on record, domoic event and this is evident in the prominent spike shown in this graph at the 2015 time stamp. This suggests a correlation between organism quantity and time of year. This graph also shows clear seasonality with a peculiar increase in magnitude of the season_year oscillations after 2015. It should also be noted that the residuals show a general trend which suggests that there are other drivers to this analysis that aren't accounted for. Finally, after examining the size of the grey bars, the long run trend and the residuals appear to be important in driving the overall variation in algae count.\n\n## Multiple Linear Regression\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndate_join_stearns <- date_join_stearns %>%\n  mutate(year = format(y_m, \"%Y\")) #extracts year from y_m  column\n\nmod <- lm(organismQuantity ~ temp + year, data = date_join_stearns) #fits a linear regression model where organism quantity is dependent and temp and year are independent variables \nsummary(mod) #summary statistics\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = organismQuantity ~ temp + year, data = date_join_stearns)\n\nResiduals:\n   Min     1Q Median     3Q    Max \n-38427 -10693  -6358  -1796 338772 \n\nCoefficients:\n              Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  2.826e+04  1.548e+02  182.58   <2e-16 ***\ntemp        -3.622e-10  8.384e+00    0.00        1    \nyear2009    -2.190e+04  1.120e+02 -195.47   <2e-16 ***\nyear2010    -1.756e+04  1.141e+02 -153.99   <2e-16 ***\nyear2011    -2.278e+03  1.121e+02  -20.33   <2e-16 ***\nyear2012    -1.435e+04  1.117e+02 -128.48   <2e-16 ***\nyear2013    -1.877e+04  1.124e+02 -167.01   <2e-16 ***\nyear2014     1.017e+04  1.135e+02   89.57   <2e-16 ***\nyear2015    -2.097e+04  1.135e+02 -184.70   <2e-16 ***\nyear2016    -2.028e+04  1.120e+02 -181.01   <2e-16 ***\nyear2017    -5.305e+03  1.123e+02  -47.26   <2e-16 ***\nyear2018    -2.121e+04  1.125e+02 -188.47   <2e-16 ***\nyear2019    -2.357e+04  1.119e+02 -210.65   <2e-16 ***\nyear2020    -2.029e+04  1.205e+02 -168.38   <2e-16 ***\nyear2021    -2.118e+04  1.126e+02 -188.20   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 37230 on 4389897 degrees of freedom\nMultiple R-squared:  0.0662,\tAdjusted R-squared:  0.0662 \nF-statistic: 2.223e+04 on 14 and 4389897 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n\nThe p-value remains the same and the coefficients again don't make much sense in terms of the data making it difficult to accept or reject the null.\n\n## Autocorrelation\n\nIn order to extract insights into seasonality and periodicity in time series data, Autocorrelation works well. Interpretation of the ACF plot involves examining the heights and patterns of the bars or spikes. The bars that extend beyond the shaded region indicate statistically significant correlations. Interpretation of this provides a graphical representation of how the values of a time series are correlated with their own past values at different lags. By specifying **`lag.max = 52`**, it constructs an autocorrelation up to a lag of 52 time points.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nacf(decomp_stearn$total_quant, lag.max=52) \n```\n\n::: {.cell-output-display}\n![](algae_temp_analysis_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\nTo assess the nature of seasonality, a 52 week annual window of time was used. This autocorrelation shows values close to 1 (such as lag 1) showing strong positive correlation with past values. There is also evident toughs and peaks representing a repeating pattern and seasonality as well as statistically significant values concluding that the observed correlations are unlikely due to random chance.\n\n## Findings\n\nAlthough this study shows seasonal trends between temperature and time over the last 15 years, the linear regression models that were run don't provide sufficient p-values or coefficients to confidently accept the null that seasonality does in fact affect algal bloom abundance and distribution. Further analysis is required.\n",
    "supporting": [
      "algae_temp_analysis_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}